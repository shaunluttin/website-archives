
<!DOCTYPE html> 
<html lang="en-US" class="static detail-blog-post dir-ltr contents" dir="ltr"> 

<!-- Mirrored from www.muddlingthru.ca/orchard-content-items-widget-items-content-parts-and-shapes by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 09 Dec 2022 06:18:56 GMT -->
<head> 
    <meta charset="utf-8" />
    <title>Muddling Thru - Parts, Fields, Items, Types, Content, Shapes, and Templates</title> 
    <link href="http://fonts.googleapis.com/css?family=Lobster&amp;subset=latin" rel="stylesheet" type="text/css" />
<link href="Themes/Bootstrap_3_3_4_Base/Styles/base.css" rel="stylesheet" type="text/css" />
<link href="Themes/Bootstrap_3_3_4_SimpleBlog/Styles/theme.css" rel="stylesheet" type="text/css" />
<!--[if lt IE 9]>
<script src="/Core/Shapes/scripts/html5.js" type="text/javascript"></script>
<![endif]-->
<meta content="Orchard" name="generator" />
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
<link href="modules/orchard.themes/Content/orchard.ico" rel="shortcut icon" type="image/x-icon" />

<link rel="alternate" type="application/rss+xml" title="Muddling Thru" href="rss91cc?containerid=12" />

    <script>(function(d){d.className="dyn"+d.className.substring(6,d.className.length);})(document.documentElement);</script> 
    <script>window.isRTL = false;</script>
</head> 
<body>


<div class="aside-1" id="layout-wrapper">
<header id="layout-header" class="group">
    <div id="header">
        <div class="zone zone-header"><h1 id="branding"><a href="index.html">Muddling Thru</a></h1>
</div>
    </div>
</header>
<div id="layout-navigation" class="group">
    <div class="zone zone-navigation">
<article class="widget-navigation widget-menu-widget widget">
    
<nav>
    <ul class="menu menu-main-menu">
        
        
    </ul>
</nav>
</article>
<article class="widget-navigation widget-html-widget widget">
    <p>Welcome to&nbsp;<a href="http://www.shaunluttin.com/">Shaun Luttin's</a> public notebook. It contains rough, practical notes. The guiding idea is that, despite what marketing tells us, there are no experts at anything. Sharing our half-baked ideas helps everyone. <strong>We're all just muddling thru</strong>. Find out more about our work at <a href="http://www.bigfont.ca/">bigfont.ca.</a></p>
</article></div>
</div>
<div id="layout-main-container">
<div id="layout-main" class="group">
    <aside id="aside-first" class="aside-first group">
        <div class="zone zone-aside-first">
<article class="widget-aside-first widget-search-form widget">
    
<form action="DISABLED_SEARCH_FORM_ACTION" class="search-form form form-inline" method="get">    <fieldset disabled>
        <input class="form-control input-lg" id="q" name="q" placeholder="Search" type="text" value="" />
        <button class="btn btn-default btn-lg" type="submit">Search!</button>
    </fieldset>
</form>
</article>
<article class="widget-aside-first widget-html-widget widget">
    <p><img class="img-thumbnail" alt="" src="Media/Default/Website-UI-Uploads/business_happy_200x200.jpg" height="200" width="200" /></p>
</article></div>
    </aside>
    <div id="layout-content" class="group">
                        <div id="content" class="group">
            <div class="zone zone-content">
<article class="blog-post content-item">
    <header>
        

<h1>Parts, Fields, Items, Types, Content, Shapes, and Templates</h1>

    <p class="tags">
        <span>Tags:</span>
<a href="Tags/orchard.html">orchard</a>, <a href="Tags/sebastienros.html">sebastienros</a>    </p>

            <div class="metadata">
                <div class="published">Thursday, August 28, 2014 7:39:40 PM</div>
            </div>
    </header>
    <p><p>&nbsp;</p> <p><font style="background-color: #ffff00">The blog post is NOT an expert opinion. Rather, it is my current understanding. Much of it is probably wrong! </font></p> <p>A tweet on Twitter precipitated a phone call with that sexy bastion of rock solid knowledge: Sebastien Ros. I wrote:</p> <blockquote> <p>Wow. I understand with a flash of understanding. <a href="https://twitter.com/hashtag/orchardcms?src=hash"><s>#</s><b>orchardcms</b></a> content items are not shapes - they are composed of shapes.</p></blockquote> <p>He replied: </p> <blockquote> <p>You’re wrong.</p></blockquote> <p>Actually, he replied:</p> <blockquote> <p>both statements are wrong actually, call me</p></blockquote> <p>That was a lovely thing for him to do. I still might be wrong but I learned a great deal. I now think that… <em>Content Items are not shapes, they are collections of parts. When Orchard is going to render a content item, it turns the content item and each of its parts into shapes that become part of the shape tree.</em></p> <hr>  <p>Let me elaborate with way too many words.</p> <p>Orchard uses templates to render shapes. Shapes represent content (and most other rendered things.) Content includes content items, which are instances of content types. Content types are composed of content parts and content fields. Parts and fields contain end user data that’s stored in the database. Depending on the stereotype of their type, content items are sometimes mapped to URLs and other times placed in widget zones. It’s a beautiful, modular, hierarchical puzzle that extends ASP.NET MVC into a content management framework. </p> <p><em>Templates</em> are fundamentally MVC <u>views</u>. In Orchard, templates are organized into a hierarchy that starts at the document and works through the layout, layout zones (in which items render,) and content item zones (in which parts and fields render.) The layout zones are what we target in the Widgets user interface, while the content item zones are what we target in placement.info files. Template implementation is most often a CSHTML file but sometimes a method with the [Shape] attribute (it would make more sense to refactor this into a ShapeTemplate attribute.) The most important thing is that <em>templates render shapes</em>.</p> <p><em>Shapes</em> are fundamentally <u>dynamic view models</u>. Shapes most often mediate between content and views, but also pass on to views data about zones (and other esoterica about which I don’t have a clue.) Orchard models content as Content Types composed of Parts and Fields. The parts and fields are what contain the end user data. Orchard has an object-relational mapping in which Content Parts and Content Fields have static models. The content manager persists and retrieves these models from the database. On retrieval, drivers may turn the static models into shapes, and the shapes will go into the shape trees (according to their placement.info file.) The Orchard view engine maps shapes to templates. In the end, it’s the shape tree that the view will render. The shape tree is a dynamic view model that templates render.</p> <p><em>Content</em> in Orchard is both stored in the database and represented in code by <u>static models</u>. Orchard’s content is organized into stereotypes, types, parts, and fields. A content type’s composition, stereotype, and other settings are stored in the database – types do not have static models. When we create an instance of a content type, it becomes a content item – in that way, content types are like classes, and content items are like objects, but the analogy breaks down, because content types are stored in the database and are not modeled with C# classes. When it comes time for rendering, the stereotype of the content type determines the content items shape type. In other words, we could rename “stereotype” to “shape type.” Types are composed of reusable parts and data fields. It’s these parts and fields that actually store end-user data and that have static C# models (e.g. TitlePart, BodyPart, InputField, BooleanField.) These static models inherit from ContentPart and ContentField classes. They, like most other things, turn into shapes prior to Orchard sending them to templates for rendering.</p> <ul> <li>Content Type  <ul> <li>has no C# class  <li>is defined in the database  <li>has one stereotype  <li>has zero to many content parts  <li>has zero to many content fields  <li>is “instantiated” into a content item</li></ul></li></ul> <hr>  <p>Let’s look at an example of how Orchard and ASP.NET MVC cooperate. Say a URL such as “/<font style="background-color: #ffff00">Contents</font>/<font style="background-color: #00ff00">Item</font>/<font style="background-color: #8cffe9">Display</font>/<font style="background-color: #ff80df">72</font>” comes in from the web. </p> <p>ASP.NET routing cooperates with Orchard.Alias and Orchard.Autoroute to find a specific controller action: <a href="https://orchard.codeplex.com/SourceControl/latest#src/Orchard.Web/Core/Contents/Controllers/ItemController.cs">Orchard.Core.Contents.Controllers.ItemController.Display(int id).</a> Notice the use of the default MVC route of “<font style="background-color: #ffff00">Area</font>/<font style="background-color: #00ff00">Controller</font>/<font style="background-color: #8cffe9">Action</font>/<font style="background-color: #ff80df">Id</font>” (and that aqua and pink are an awesome colors.) This controller action will return a View bound to a shape.</p><pre>public ActionResult Display(int id) {
    var contentItem = _contentManager.Get(id, VersionOptions.Published);
    var model = _contentManager.BuildDisplay(contentItem);
    return View(model);
}</pre></p>

<p>Inside that <font style="background-color: #8cffe9">Display</font> action, three important things happen. <strong>First</strong>, Orchard’s ContentManager uses its Get() method to retrieve the appropriate content item from the database. (Remember: a content item is an “instance” of a content type and is composed of several Content Parts.) <strong>Second</strong>, the ContentManager’s BuildDisplay method invokes all the ContentHandlers for all those Content Parts.&nbsp; One of those ContentHandlers is going to be the ContentPartDriver. Each driver will turn its part’s static data model into zero to many dynamic shapes. As each driver creates the shapes, it references placement.info to place the shape into the appropriate content item zone (c.f. layout zone) in the shape tree. When BuildDisplay returns, it has a shape that represents the content item and all its component parts. Now, the Display action can do its <strong>third </strong>step: return a View that’s bound to the shape that represents the content item.</p>

<blockquote>
<p>Parts do not call drivers; rather, BuildDisplay resolves all the ContentHandlers, including ContentPartDriver, which cooperates with placement.info to give the shape tree more shapes. ContentPartDriver is a special ContentHandler that creates shapes from parts.</p></blockquote>

<p>Let’s continue by assuming that “/<font style="background-color: #ffff00">Contents</font>/<font style="background-color: #00ff00">Item</font>/<font style="background-color: #8cffe9">Display</font>/<font style="background-color: #ff80df">72</font>” routes to a content item of type Page. In Orchard, the page content type has a stereotype of “Content” (this is the default stereotype, others are “Widget” and “Media”). The stereotype of a content type becomes the content item’s shape type. Since Page has the “Content” stereotype, when the Display action (from the previous paragraph) returns a view object, the view maps to the <a href="https://orchard.codeplex.com/SourceControl/latest#src/Orchard.Web/Core/Contents/Views/Content.cshtml">Content.cshtml</a> template or a more specific alternate that matches the shape type. If it were of the Widget of Media stereotype, it would map to the Widget.cshtml or Media.cshtml templates (or more specific alternates). Now, the rendering engine can combine the page content item’s shape with the content.cshtml template.</p>

<p>If we look at Content.cshtml, note that its Model has several zones: Title, Header, Meta, Content, Footer. It’s into the zones that the parts and fields will go. These content item zones are similar but distinct from the layout zones in the Layout.cshtml template. The zones in layout.cshtml are places that content <em>items</em> will render, and we place them there through the Widgets user interface in Orchard’s dashboard; other the other hand, the zones in content.cshtml are places that content <em>parts</em> and <em>fields</em> will render, and we place them there through placement.info files. The Page content type contains a Title and Body Part, let’s look at the <a href="https://orchard.codeplex.com/SourceControl/latest#src/Orchard.Web/Core/Title/Placement.info">placement.info file for the the title part</a>. It’s brief. Among other things, it says that, if we are in the Detail display, to place the “Parts_Title” shape into its parent item’s “Content” zone at position 5.</p>

<p>Whew. Orchard has processed the Page content item that the end user requested with the “/<font style="background-color: #ffff00">Contents</font>/<font style="background-color: #00ff00">Item</font>/<font style="background-color: #8cffe9">Display</font>/<font style="background-color: #ff80df">72</font>” URL. This involved routing to a controller, retrieval from the database, creation and placement of shapes out of content parts, and rendering through a template. The next steps involve incorporating the html that represents that page content item, along with any other widget content items, into the layout.cshtml file, and then incorporating of the layout.cshtml into the document.cshtml. All of this will involves shapes passing data to templates.</p>

<h1>Appendix: Some Personal, Half Baked Notes</h1>

<p>Orchard renders the Shape Tree. The Shape Tree is a bunch of nested shapes. Content Items, Widget Items, and Content Parts are not shapes. Rather, Orchard turns them into shapes prior to rendering.</p>

<h2>Orchard Page Request Process</h2>

<table cellspacing="0" cellpadding="2" width="580" border="1">
<tbody>
<tr>
<td valign="top" width="91">Url</td>
<td valign="top" width="223">&nbsp;</td>
<td valign="top" width="155">&nbsp;</td>
<td valign="top" width="109">&nbsp;</td></tr>
<tr>
<td valign="top" width="91">Routing</td>
<td valign="top" width="223">&nbsp;</td>
<td valign="top" width="155">&nbsp;</td>
<td valign="top" width="109">&nbsp;</td></tr>
<tr>
<td valign="top" width="91">Controller</td>
<td valign="top" width="223">&nbsp;</td>
<td valign="top" width="155">&nbsp;</td>
<td valign="top" width="109">&nbsp;</td></tr>
<tr>
<td valign="top" width="91">&nbsp;</td>
<td valign="top" width="223">ContentManager.Get</td>
<td valign="top" width="155">&nbsp;</td>
<td valign="top" width="109">&nbsp;</td></tr>
<tr>
<td valign="top" width="91">&nbsp;</td>
<td valign="top" width="223">ContentManager.BuildDisplay</td>
<td valign="top" width="155">&nbsp;</td>
<td valign="top" width="109">&nbsp;</td></tr>
<tr>
<td valign="top" width="91">&nbsp;</td>
<td valign="top" width="223">&nbsp;</td>
<td valign="top" width="155">ContentPartHandlers</td>
<td valign="top" width="109">&nbsp;</td></tr>
<tr>
<td valign="top" width="91">&nbsp;</td>
<td valign="top" width="223">&nbsp;</td>
<td valign="top" width="155">ContentPartDrivers</td>
<td valign="top" width="109">&nbsp;</td></tr>
<tr>
<td valign="top" width="91">&nbsp;</td>
<td valign="top" width="223">&nbsp;</td>
<td valign="top" width="155">&nbsp;</td>
<td valign="top" width="109">ContentShape</td></tr>
<tr>
<td valign="top" width="91">View</td>
<td valign="top" width="223">&nbsp;</td>
<td valign="top" width="155">&nbsp;</td>
<td valign="top" width="109">&nbsp;</td></tr></tbody></table>

<h2>The Shape Tree</h2>

<p>The Orchard rendering engine renders the Shape Tree, which, among other things, contains a hierarchy of shapes that <em>represent </em>instances of Zones, Content Types, and Content Parts. For instance, <strong>while Widget Items, Content Items and Content Parts are not Shapes, Orchard <em>turns</em> <em>them into Shapes</em> before it renders them.</strong> The Shape Tree contains Shapes to represent Content Parts, Content Zones, Content Items, Widget Items, Layout Zones, the Layout, and the Document. The shape tree contains…</p>

<p><ul>
<li>Shape that represents the document. 
<ul>
<li>Shape that represents the layout. 
<ul>
<li>Shapes that represents each layout zone (header, navigation, featured, beforeMain…) 
<ul>
<li>Shapes that represent content type instances (content items, widget items, media items). 
<ul>
<li>Shapes that represent each content zone (header, content, footer) 
<ul>
<li>Shapes that represent content part instances. 
<ul>
<li>Shapes the represent field instances.</li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></p>

<p>Let’s focus on Content Items and Content Parts.</p>

<table cellspacing="0" cellpadding="2" width="717" border="1">
<tbody>
<tr>
<td valign="top" width="195"><strong>Methods like…</strong></td>
<td valign="top" width="107"><strong>takes a…</strong></td>
<td valign="top" width="104"><strong>and returns zero to many…</strong></td>
<td valign="top" width="309"><strong>where the Shape type comes from the…</strong></td></tr>
<tr>
<td valign="top" width="195"><code>ContentPartDriver.Action</code></td>
<td valign="top" width="107">Content Part</td>
<td valign="top" width="104">Shapes</td>
<td valign="top" width="309">ContentShape’s shapeType parameter.<br>(e.g. Parts_Title, Parts_Title_Summary)</td></tr>
<tr>
<td valign="top" width="195"><code>BuildDisplay</code></td>
<td valign="top" width="107">Content Item</td>
<td valign="top" width="104">Shape</td>
<td valign="top" width="309">Content Type’s stereotype.<br>(e.g. Content, Widget, Media)</td></tr></tbody></table>

<h2>TitlePartDriver.Display</h2>

<p><p>Take a TitlePart, return zero to three Shapes of type Parts<em>Title, Parts</em>Title<em>Summary, and/or Parts</em>Title<em>Summary</em>Admin.</p><pre>protected override DriverResult Display(TitlePart part, string displayType, dynamic shapeHelper) {
    return Combined(
        ContentShape("Parts<em>Title",
            () =&gt; shapeHelper.Parts</em>Title(Title: part.Title)),
        ContentShape("Parts<em>Title</em>Summary",
            () =&gt; shapeHelper.Parts<em>Title</em>Summary(Title: part.Title)),
        ContentShape("Parts<em>Title</em>SummaryAdmin",
            () =&gt; shapeHelper.Parts<em>Title</em>SummaryAdmin(Title: part.Title))
        );
}
</pre></p>

<h2>The Page Type Shape Tree</h2>

<p>Orchard has a Content Type called Page. It contains a TitlePart and BodyPart. It has stereotype Content (which is the default Stereotype). When we render that Page, the Shape Tree looks a bit like this: </p>

<ul>
<li>Zone [Header] 
<li>… 
<li>… 
<li><font style="background-color: #ffff00"><strong>Zone [Content]</strong> </font>
<ul>
<li><font style="background-color: #ffff00"><strong>Content</strong> </font>
<ul>
<li><font style="background-color: #ffff00"><strong>Parts_Title</strong> </font>
<li><strong><font style="background-color: #ffff00">Parts_Common_Body</font></strong></li></ul></li></ul>
<li>Zone [AsideSecond] 
<li>Zone [Footer]</li></ul>

<p>The Page Content Type has stereotype <strong>Content</strong>, so it shows up in the Shape Tree as Content. The TitlePart and BodyPart have shapeType <strong>Parts_Title</strong>, and <strong>Parts_Common_Body</strong>, so that’s how they show up in the tree.</p>

<h2>The Html Widget Type Shape Tree</h2>

<p>Orchard has a Content Type called Html Widget that contain a WidgetPart and BodyPart. It has the stereotype Widget. When we render the Html Widget, the Shape Tree looks a bit like this:</p>

<ul>
<li>Zone [Header] 
<li>… 
<li>… 
<li><font style="background-color: #ffff00"><strong>Zone [BeforeMain]</strong> </font>
<ul>
<li><strong><font style="background-color: #ffff00">Widget</font></strong> 
<ul>
<li><strong><font style="background-color: #ffff00">Parts_Common_Body</font></strong></li></ul></li></ul>
<li>Zone [AsideSecond] 
<li>Zone [Footer]</li></ul>

<p>The HTML Widget Content Type has stereotype <strong>Widget</strong>, so it shows up in the Shape Tree as Widget. The BodyPart has shapeType <strong>Parts_Common_Body</strong>, so that’s how it shows.</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<ul><!--EndFragment--></ul>

</article></div>
        </div>
            </div>
</div>
</div>
<div id="layout-footer" class="group">
    <footer id="footer">
        <div id="footer-quad" class="group">
                                            </div>
        <div id="footer-sig" class="group">
            <div class="zone zone-footer"><div class="credits">
    <span class="poweredby">Powered by <a href="http://www.orchardproject.net/" target="_blank">Orchard</a></span>
    <span class="copyright">&#169; Bootstrap 3.3.4 Simple Blog 2015.</span>
</div>
<div class="user-display">
        <span class="user-actions"><a href="Users/Account/LogOne049.html?ReturnUrl=%2Forchard-content-items-widget-items-content-parts-and-shapes" rel="nofollow">Sign In</a></span>
</div></div>
        </div>
    </footer>
</div>
</div>
<script src="Themes/Bootstrap_3_3_4_Base/scripts/base.js" type="text/javascript"></script>
<script src="Themes/Bootstrap_3_3_4_Base/scripts/theme.js" type="text/javascript"></script>

</body>

<!-- Mirrored from www.muddlingthru.ca/orchard-content-items-widget-items-content-parts-and-shapes by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 09 Dec 2022 06:18:57 GMT -->
</html>